CREATE TABLE
  SCHOOL_REPORTING_REQUIREMENT_CODE (
    SCHOOL_REPORTING_REQUIREMENT_CODE VARCHAR(10) NOT NULL,
    LABEL VARCHAR(30) NOT NULL,
    DESCRIPTION VARCHAR(255) NOT NULL,
    DISPLAY_ORDER NUMERIC DEFAULT 1 NOT NULL,
    EFFECTIVE_DATE TIMESTAMP NOT NULL,
    EXPIRY_DATE TIMESTAMP NOT NULL,
    CREATE_USER VARCHAR(32) NOT NULL,
    CREATE_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    UPDATE_USER VARCHAR(32) NOT NULL,
    UPDATE_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    CONSTRAINT SCHOOL_REPORTING_REQUIREMENT_CODE_PK PRIMARY KEY (SCHOOL_REPORTING_REQUIREMENT_CODE)
  );

INSERT INTO SCHOOL_REPORTING_REQUIREMENT_CODE
  (SCHOOL_REPORTING_REQUIREMENT_CODE, LABEL, DESCRIPTION, DISPLAY_ORDER,
    EFFECTIVE_DATE,
    EXPIRY_DATE,
    CREATE_USER, CREATE_DATE,
    UPDATE_USER, UPDATE_DATE)
  VALUES
  ('REGULAR', 'Regular', 'The school submits a standard 1701 file', 1,
    to_date ('2020-01-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS'),
    to_date ('2099-12-31 00:00:00', 'YYYY-MM-DD HH24:MI:SS'),
    'TRERICHA', to_date ('2023-03-20 00:00:00', 'YYYY-MM-DD HH24:MI:SS'),
    'TRERICHA', to_date ('2023-03-20 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO SCHOOL_REPORTING_REQUIREMENT_CODE
  (SCHOOL_REPORTING_REQUIREMENT_CODE, LABEL, DESCRIPTION, DISPLAY_ORDER,
    EFFECTIVE_DATE,
    EXPIRY_DATE,
    CREATE_USER, CREATE_DATE,
    UPDATE_USER, UPDATE_DATE)
  VALUES
  ('CSF', 'Conseil Scolaire Francophone', 'The school must be in a CSF district', 1,
    to_date ('2020-01-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS'),
    to_date ('2099-12-31 00:00:00', 'YYYY-MM-DD HH24:MI:SS'),
    'TRERICHA', to_date ('2023-03-20 00:00:00', 'YYYY-MM-DD HH24:MI:SS'),
    'TRERICHA', to_date ('2023-03-20 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO SCHOOL_REPORTING_REQUIREMENT_CODE
  (SCHOOL_REPORTING_REQUIREMENT_CODE, LABEL, DESCRIPTION, DISPLAY_ORDER,
    EFFECTIVE_DATE,
    EXPIRY_DATE,
    CREATE_USER, CREATE_DATE,
    UPDATE_USER, UPDATE_DATE)
  VALUES
  ('RT', 'Reciprocal Tuition', 'The school submits an RT during a 1701 collection', 1,
    to_date ('2020-01-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS'),
    to_date ('2099-12-31 00:00:00', 'YYYY-MM-DD HH24:MI:SS'),
    'TRERICHA', to_date ('2023-03-20 00:00:00', 'YYYY-MM-DD HH24:MI:SS'),
    'TRERICHA', to_date ('2023-03-20 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));

INSERT INTO SCHOOL_REPORTING_REQUIREMENT_CODE
  (SCHOOL_REPORTING_REQUIREMENT_CODE, LABEL, DESCRIPTION, DISPLAY_ORDER,
    EFFECTIVE_DATE,
    EXPIRY_DATE,
    CREATE_USER, CREATE_DATE,
    UPDATE_USER, UPDATE_DATE)
  VALUES
  ('NONE', 'None', 'The school does not submit a 1701 file', 1,
    to_date ('2020-01-01 00:00:00', 'YYYY-MM-DD HH24:MI:SS'),
    to_date ('2099-12-31 00:00:00', 'YYYY-MM-DD HH24:MI:SS'),
    'TRERICHA', to_date ('2023-03-20 00:00:00', 'YYYY-MM-DD HH24:MI:SS'),
    'TRERICHA', to_date ('2023-03-20 00:00:00', 'YYYY-MM-DD HH24:MI:SS'));

ALTER TABLE SCHOOL
  ADD COLUMN SCHOOL_REPORTING_REQUIREMENT_CODE VARCHAR(10) DEFAULT 'REGULAR' NOT NULL;

ALTER TABLE SCHOOL
  ADD CONSTRAINT SCHOOL_REPORTING_REQUIREMENT_CODE_FK
    FOREIGN KEY (SCHOOL_REPORTING_REQUIREMENT_CODE)
      REFERENCES SCHOOL_REPORTING_REQUIREMENT_CODE(SCHOOL_REPORTING_REQUIREMENT_CODE);

UPDATE SCHOOL
  SET SCHOOL_REPORTING_REQUIREMENT_CODE = 'NONE'
  WHERE SCHOOL_CATEGORY_CODE IN ('YUKON', 'POST_SEC', 'EAR_LEARN')
  OR SCHOOL_ORGANIZATION_CODE = 'SPEC_RPRT';

UPDATE SCHOOL
  SET SCHOOL_REPORTING_REQUIREMENT_CODE = 'CSF'
  WHERE DISTRICT_ID = (SELECT DISTRICT_ID FROM DISTRICT WHERE DISTRICT_NUMBER = '093');

UPDATE SCHOOL
  SET SCHOOL_REPORTING_REQUIREMENT_CODE = 'RT'
  FROM DISTRICT,
  (VALUES
    ('005', '97007'),
    ('022', '97070'),
    ('027', '97017'),
    ('027', '97038'),
    ('027', '97084'),
    ('027', '97171'),
    ('033', '97044'),
    ('033', '97082'),
    ('044', '97058'),
    ('045', '97081'),
    ('048', '97085'),
    ('050', '97001'),
    ('053', '97069'),
    ('058', '97075'),
    ('059', '97059'),
    ('063', '97060'),
    ('063', '97073'),
    ('067', '97079'),
    ('068', '97042'),
    ('068', '97052'),
    ('068', '97078'),
    ('070', '97037'),
    ('073', '97011'),
    ('073', '97492'),
    ('073', '97035'),
    ('074', '97031'),
    ('074', '97062'),
    ('078', '97034'),
    ('078', '97494'),
    ('079', '97046'),
    ('079', '97055'),
    ('082', '97024'),
    ('082', '97043'),
    ('082', '97083'),
    ('083', '97039'),
    ('085', '97049'),
    ('085', '97057'),
    ('091', '97040'),
    ('091', '97056'),
    ('091', '97071'),
    ('091', '97486')
  ) AS MINCODE (DISTRICT_NUMBER, SCHOOL_NUMBER)
  WHERE DISTRICT.DISTRICT_ID = (
        SELECT DISTRICT_ID
        FROM DISTRICT
        WHERE DISTRICT_NUMBER = MINCODE.DISTRICT_NUMBER
    )
    AND SCHOOL.SCHOOL_NUMBER = MINCODE.SCHOOL_NUMBER;

