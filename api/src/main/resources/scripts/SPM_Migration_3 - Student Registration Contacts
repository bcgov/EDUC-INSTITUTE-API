CREATE TABLE DISTRICT_CONTACT_COORD
as
SELECT
    LOWER(REGEXP_REPLACE(dbms_crypto.randombytes(16), '(.{8})(.{4})(.{4})(.{4})(.{12})', '\1-\2-\3-\4-\5')) as DISTRICT_CONTACT_ID,
    (SELECT dist.DISTRICT_ID from DISTRICT dist WHERE coord.DISTNO = dist.DISTRICT_NUMBER) as DISTRICT_ID,
    regexp_substr(INITCAP(TRIM(coord.PEN_COORDINATOR_NAME)), '[^ ]+', 1, 1) as FIRST_NAME,
    regexp_substr(INITCAP(TRIM(coord.PEN_COORDINATOR_NAME)), '[^ ]+', 1, 2) as LAST_NAME,
    NULL as JOB_TITLE,
(CAST(NULL as VARCHAR2(100))) as PHONE_NUMBER,
(CAST(NULL as VARCHAR2(100))) as PHONE_EXTENSION,
(CAST(NULL as VARCHAR2(100))) as ALT_PHONE_NUMBER,
(CAST(NULL as VARCHAR2(100))) as ALT_PHONE_EXTENSION,
    TRIM(coord.PEN_COORDINATOR_EMAIL) as EMAIL,
    'STUDREGIS' as SCHOOL_CONTACT_TYPE_CODE,
    sysdate as EFFECTIVE_DATE,
(CAST(NULL as DATE)) as EXPIRY_DATE,
    'SPM_MIGRATION' as CREATE_USER,
    sysdate as CREATE_DATE,
    'SPM_MIGRATION' as UPDATE_USER,
    sysdate as UPDATE_DATE
    FROM PEN_COORDINATOR coord
    WHERE TRIM(coord.PEN_COORDINATOR_NAME) IS NOT NULL
    AND TRIM(coord.PEN_COORDINATOR_EMAIL) IS NOT NULL
    AND TRIM(SCHLNO) = '00000';

CREATE TABLE SCHOOL_CONTACT_COORD
as
SELECT
    LOWER(REGEXP_REPLACE(dbms_crypto.randombytes(16), '(.{8})(.{4})(.{4})(.{4})(.{12})', '\1-\2-\3-\4-\5')) as SCHOOL_CONTACT_ID,
    (SELECT schl.SCHOOL_ID from SCHOOL schl WHERE coord.SCHLNO = schl.SCHOOL_NUMBER AND coord.DISTNO = (SELECT dist.DISTRICT_NUMBER from DISTRICT dist WHERE schl.DISTRICT_ID = dist.DISTRICT_ID)) as SCHOOL_ID,
    regexp_substr(INITCAP(TRIM(coord.PEN_COORDINATOR_NAME)), '[^ ]+', 1, 1) as FIRST_NAME,
    regexp_substr(INITCAP(TRIM(coord.PEN_COORDINATOR_NAME)), '[^ ]+', 1, 2) as LAST_NAME,
    NULL as JOB_TITLE,
    (CAST(NULL as VARCHAR2(100))) as PHONE_NUMBER,
    (CAST(NULL as VARCHAR2(100))) as PHONE_EXTENSION,
    (CAST(NULL as VARCHAR2(100))) as ALT_PHONE_NUMBER,
    (CAST(NULL as VARCHAR2(100))) as ALT_PHONE_EXTENSION,
    TRIM(coord.PEN_COORDINATOR_EMAIL) as EMAIL,
    'STUDREGIS' as SCHOOL_CONTACT_TYPE_CODE,
    sysdate as EFFECTIVE_DATE,
    (CAST(NULL as DATE)) as EXPIRY_DATE,
    'SPM_MIGRATION' as CREATE_USER,
    sysdate as CREATE_DATE,
    'SPM_MIGRATION' as UPDATE_USER,
    sysdate as UPDATE_DATE
FROM PEN_COORDINATOR coord
WHERE TRIM(coord.PEN_COORDINATOR_NAME) IS NOT NULL
  AND TRIM(coord.PEN_COORDINATOR_EMAIL) IS NOT NULL
  AND TRIM(SCHLNO) != '00000';
